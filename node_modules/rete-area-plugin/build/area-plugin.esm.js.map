{"version":3,"file":"area-plugin.esm.js","sources":["../src/background.js","../src/restrictor.js","../src/snap.js","../src/utils.js","../src/zoom-at.js","../src/index.js"],"sourcesContent":["export class Background {\n    constructor(editor, element) {\n        if (!element) return;\n        const el = element instanceof HTMLElement ? element : document.createElement('div');\n     \n        el.classList += ` rete-background ${element === true ? 'default' : ''}`;\n        editor.view.area.appendChild(el);\n    }\n}","export class Restrictor {\n    constructor(editor, scaleExtent, translateExtent) {\n        this.editor = editor;\n        this.scaleExtent = scaleExtent;\n        this.translateExtent = translateExtent;\n\n        if (scaleExtent)\n            editor.on('zoom', this.restrictZoom.bind(this));\n        if (translateExtent)\n            editor.on('translate', this.restrictTranslate.bind(this));\n    }\n\n    restrictZoom(data) {\n        const se = typeof this.scaleExtent === 'boolean' ? { min: 0.1, max: 1 } : this.scaleExtent;\n        const tr = data.transform;\n\n        if (data.zoom < se.min)\n            data.zoom = se.min;\n        else if (data.zoom > se.max)\n            data.zoom = se.max;\n    }\n\n    restrictTranslate(data) {\n        const te = typeof this.translateExtent === 'boolean' ? { width: 5000, height: 4000 } : this.translateExtent;\n        const { container } = this.editor.view;\n        const k = data.transform.k;\n        const [kw, kh] = [te.width * k, te.height * k];\n        const cx = container.clientWidth / 2;\n        const cy = container.clientHeight / 2;\n\n        data.x -= cx;\n        data.y -= cy;\n        \n        if (data.x > kw)\n            data.x = kw;\n        else if (data.x < - kw)\n            data.x = - kw;\n        \n        if (data.y > kh)\n            data.y = kh;\n        else if (data.y < - kh)\n            data.y = - kh;\n        \n        data.x += cx;\n        data.y += cy;\n    }\n}","export class SnapGrid {\n    constructor(editor, { size = 16, dynamic = true }) {\n        this.editor = editor;\n        this.size = size;\n\n        if (dynamic)\n            this.editor.on('nodetranslate', this.onTranslate.bind(this))\n        else\n            this.editor.on('rendernode', ({ node, el }) => {\n                el.addEventListener('mouseup', this.onDrag.bind(this, node));\n                el.addEventListener('touchend', this.onDrag.bind(this, node));\n                el.addEventListener('touchcancel', this.onDrag.bind(this, node));\n            });\n    }\n\n    onTranslate(data) {\n        const { x, y } = data;\n\n        data.x = this.snap(x);\n        data.y = this.snap(y);\n    }\n\n    onDrag(node) {\n        const [ x, y ] = node.position;\n\n        node.position[0] = this.snap(x);\n        node.position[1] = this.snap(y);\n        console.log(this, x, y, node.position)\n        \n        this.editor.view.nodes.get(node).update();\n        this.editor.view.updateConnections({ node });\n    }\n    \n    snap(value) {\n        return Math.round(value/this.size) * this.size;\n    }\n}","const min = (arr) => arr.length === 0 ? 0 : Math.min(...arr);\nconst max = (arr) => arr.length === 0 ? 0 : Math.max(...arr);\n\nexport function nodesBBox(editor, nodes) {\n    const left = min(nodes.map(node => node.position[0]));\n    const top = min(nodes.map(node => node.position[1]));\n    const right = max(nodes.map(node => node.position[0] + editor.view.nodes.get(node).el.clientWidth));\n    const bottom = max(nodes.map(node => node.position[1] + editor.view.nodes.get(node).el.clientHeight));\n    \n    return {\n        left,\n        right,\n        top,\n        bottom,\n        width: Math.abs(left - right),\n        height: Math.abs(top - bottom),\n        getCenter: () => {\n            return [\n                (left + right) / 2,\n                (top + bottom) / 2\n            ];\n        }\n    };\n}","import { nodesBBox } from './utils';\n\nexport function zoomAt(editor, nodes = editor.nodes) {\n    const bbox = nodesBBox(editor, nodes);\n    const [x, y] = bbox.getCenter();\n    const [w, h] = [editor.view.container.clientWidth, editor.view.container.clientHeight];\n    const { area } = editor.view;\n\n    var [kw, kh] = [w / bbox.width, h / bbox.height]\n    var k = Math.min(kh * 0.9, kw * 0.9, 1);\n\n    area.transform.x = area.container.clientWidth / 2 - x * k;\n    area.transform.y = area.container.clientHeight / 2 - y * k;\n    area.zoom(k, 0, 0);\n    \n    area.update();\n}","import './style.sass';\nimport { Background } from './background';\nimport { Restrictor } from './restrictor';\nimport { SnapGrid } from './snap';\nimport { zoomAt } from './zoom-at';\n\nfunction install(editor, params) {\n    let background = params.background || false;\n    let snap = params.snap || false;\n    let scaleExtent = params.scaleExtent || false;\n    let translateExtent = params.translateExtent || false;\n\n    if (background) {\n        this._background = new Background(editor, background);\n    }\n    if (scaleExtent || translateExtent) {\n        this._restrictor = new Restrictor(editor, scaleExtent, translateExtent)\n    }\n    if (snap) {\n        this._snap = new SnapGrid(editor, snap);\n    }\n}    \n\nexport default {\n    install,\n    zoomAt\n}"],"names":["Background","editor","element","el","HTMLElement","document","createElement","classList","view","area","appendChild","Restrictor","scaleExtent","translateExtent","on","restrictZoom","bind","restrictTranslate","data","se","min","max","tr","transform","zoom","te","width","height","container","k","kw","kh","cx","clientWidth","cy","clientHeight","x","y","SnapGrid","size","dynamic","onTranslate","node","addEventListener","onDrag","snap","position","console","log","nodes","get","update","updateConnections","value","Math","round","arr","length","nodesBBox","left","map","top","right","bottom","abs","getCenter","zoomAt","bbox","w","h","install","params","background","_background","_restrictor","_snap"],"mappings":"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"}